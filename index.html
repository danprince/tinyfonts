<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pixel font playground</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body x-data="init()" x-init="mount()" @beforeunload.window="unmount()">
    <aside class="sidebar">
      <fieldset x-show="!hasTexture()">
        <legend>Upload texture</legend>
        <p>Paste, drag and drop, or upload a bitmap font image.</p>
        <input type="file" />
      </fieldset>

      <fieldset x-show="hasTexture">
        <button @click="reset()">New</button>
        <button disabled>Export</button>
      </fieldset>

      <fieldset>
        <legend>Font</legend>
        <div>
          <button data-step="-1">-</button>
          <input
            id="glyphWidth"
            x-model.number="glyphWidth"
            type="number"
            min="1"
            max="999"
          />
          <button data-step="+1">+</button>
          <label for="glyphWidth">Glyph width</label>
        </div>
        <div>
          <button data-step="-1">-</button>
          <input
            id="glyphHeight"
            x-model.number="glyphHeight"
            type="number"
            min="1"
            max="999"
          />
          <button data-step="+1">+</button>
          <label for="glyphHeight">Glyph height</label>
        </div>
        <div>
          <button data-step="-1">-</button>
          <input
            id="lineHeight"
            x-model.number="lineHeight"
            type="number"
            min="1"
            max="999"
            :placeholder="glyphHeight"
          />
          <button data-step="+1">+</button>
          <label for="lineHeight">Line height</label>
        </div>
        <div>
          <button data-step="-1">-</button>
          <input
            id="startCharCode"
            x-model.number="startCharCode"
            type="number"
            min="0"
            max="999"
            placeholder="32"
          />
          <button data-step="1">+</button>
          <label for="startCharCode">Start char code</label>
        </div>
        <div>
          <button data-step="-1">-</button>
          <input
            id="endCharCode"
            x-model.number="endCharCode"
            type="number"
            min="0"
            max="999"
            placeholder="128"
          />
          <button data-step="1">+</button>
          <label for="endCharCode">End char code</label>
        </div>
      </fieldset>

      <fieldset class="glyph-form">
        <legend>Glyphs</legend>

        <div class="glyph-preview">
          <canvas
            style="height: 64px"
            x-effect="renderGlyphWithMetrics($el, currentGlyph)"
          ></canvas>
        </div>

        <div class="glyph-metrics">
          <div>
            <button data-step="-1">&lt;</button>
            <input
              id="currentGlyph"
              x-model.number="currentGlyph"
              type="number"
              min="0"
              max="999"
              :placeholder="0"
            />
            <button data-step="1">&gt;</button>
            <label for="currentGlyph">
              Glyph (<span x-text="String.fromCharCode(currentGlyph)"></span>)
            </label>
          </div>

          <div>
            <button data-step="-1">-</button>
            <input
              id="advanceWidth"
              x-model.number="advanceWidths[currentGlyph]"
              type="number"
              min="1"
              max="999"
              :placeholder="glyphWidth"
            />
            <button data-step="1">+</button>
            <label for="advanceWidth">Advance width</label>
          </div>

          <div>
            <button data-step="-1">-</button>
            <input
              id="xOffset"
              x-model.number="xOffsets[currentGlyph]"
              type="number"
              min="-999"
              max="999"
              placeholder="0"
            />
            <button data-step="1">+</button>
            <label for="xOffset">X offset</label>
          </div>

          <div>
            <button data-step="-1">-</button>
            <input
              id="yOffset"
              x-model.number="yOffsets[currentGlyph]"
              type="number"
              min="-999"
              max="999"
              placeholder="0"
            />
            <button data-step="1">+</button>
            <label for="yOffset">Y offset</label>
          </div>
        </div>

        <div class="glyphs">
          <template x-for="index in (endCharCode - startCharCode)">
            <button
              class="glyph"
              :data-glyph="index - 1 + startCharCode"
              @click="currentGlyph = index - 1 + startCharCode"
            >
              <canvas
                x-effect="renderGlyph($el, index - 1 + startCharCode)"
              ></canvas>
            </button>
          </template>
        </div>
      </fieldset>

      <fieldset>
        <legend>Previews</legend>

        <div>
          <input id="textColor" type="color" x-model="textColor" />
          <label for="textColor">Color</label>
        </div>

        <div>
          <input id="backgroundColor" type="color" x-model="backgroundColor" />
          <label for="backgroundColor">Background</label>
        </div>

        <div>
          <input id="strokeColor" type="color" x-model="strokeColor" />
          <label for="strokeColor">Stroke</label>
        </div>

        <div>
          <input
            id="strokeBits"
            type="number"
            x-model="strokeBits"
            min="0"
            max="256"
          />
          <label for="strokeBits">Stroke bits</label>
        </div>
        <div class="stroke-bits">
          <button :data-mask="strokeBits & 32" @click="strokeBits ^= 32">
            ‚Üñ
          </button>
          <button :data-mask="strokeBits & 64" @click="strokeBits ^= 64">
            ‚Üë
          </button>
          <button :data-mask="strokeBits & 128" @click="strokeBits ^= 128">
            ‚Üó
          </button>
          <button :data-mask="strokeBits & 16" @click="strokeBits ^= 16">
            ‚Üê
          </button>
          <button :data-mask="strokeBits & 1" @click="strokeBits ^= 1">
            ‚Üí
          </button>
          <button :data-mask="strokeBits & 8" @click="strokeBits ^= 8">
            ‚Üô
          </button>
          <button :data-mask="strokeBits & 4" @click="strokeBits ^= 4">
            ‚Üì
          </button>
          <button :data-mask="strokeBits & 2" @click="strokeBits ^= 2">
            ‚Üò
          </button>
          <button @click="strokeBits = 0">üóëÔ∏è</button>
        </div>
        <div>
          <button data-step="-1">-</button>
          <input
            id="padding"
            type="number"
            x-model.number="padding"
            min="0"
            max="999"
            placeholder="0"
          />
          <button data-step="+1">+</button>
          <label for="padding">Padding</label>
        </div>
      </fieldset>
      <fieldset>
        <legend>Export JavaScript</legend>
        <textarea
          class="code-export"
          readonly
          style="width: 100%"
          x-init="autoresize($el)"
          x-text="generateJavaScript()"
          @focus="$el.select()"
        ></textarea>
      </fieldset>
    </aside>

    <main class="viewer">
      <div class="content">
        <template x-for="preview of previews">
          <div class="preview">
            <h3 x-text="preview.title"></h3>

            <input
              x-show="preview.wrap"
              x-model="preview.text"
              placeholder="Enter some preview text"
            />

            <textarea
              x-show="!preview.wrap"
              x-model="preview.text"
              x-init="autoresize($el)"
              placeholder="Enter some preview text here"
            ></textarea>

            <div x-show="preview.custom">
              <div>
                <button data-step="-1">-</button>
                <input
                  type="number"
                  x-model.number="preview.width"
                  min="1"
                  max="999"
                />
                <button data-step="+1">+</button>
                <label>Width</label>
              </div>
              <div>
                <input type="checkbox" x-model.boolean="preview.wrap" />
                <label>Wrap text?</label>
              </div>
            </div>

            <canvas
              :width="preview.width"
              x-effect="renderText($el, preview.text, preview.wrap)"
            ></canvas>
          </div>
        </template>
      </div>
    </main>
  </body>
  <script type="module" src="app.js"></script>
  <script defer src="//unpkg.com/alpinejs"></script>
</html>
